# iOSÈÄÜÂêëÁ¨îËÆ∞

## Â∑•ÂÖ∑

1. Ë∂äÁã±ÊâãÊú∫ÔºåÂÆâË£ÖCydiaÔºåÁî®‰∫éËé∑ÂèñË∂äÁã±Â∑•ÂÖ∑
2. OpenSSH(Cydia)‚Äî‚ÄîsshËøûÊé•Ë∂äÁã±ÊâãÊú∫
3. Cycript(Cydia)‚Äî‚ÄîÊâæÂá∫Â∫îÁî®DocumentsÁöÑË∑ØÂæÑ
4. Mac-Apple Configurator 2
5. Mac-Command Line Tools
6. [yololib](https://link.jianshu.com/?t=https://github.com/KJCracks/yololib)
7. [class-dump](https://link.jianshu.com/?t=http://stevenygard.com/projects/*class-dump*/)
8. [dumpdecrypted](https://link.jianshu.com/?t=https://github.com/stefanesser/dumpdecrypted)
9. Xcode
10. ËãπÊûúÂºÄÂèëËÄÖËØÅ‰π¶Êàñ‰ºÅ‰∏öËØÅ‰π¶

## Ëé∑ÂèñÂ∫îÁî®ipaÂåÖ

1. Âú®Ë∂äÁã±ÊâãÊú∫‰∏äÈÄöËøáappstoreÂÆâË£ÖÈúÄË¶ÅÈÄÜÂêëÊìç‰ΩúÁöÑÂ∫îÁî®

2. ÊâìÂåÖMacÁîµËÑëÔºåÊâìÂºÄApple Configurator 2ÔºåÁÇπÂáªËèúÂçïÊ†è-Ë¥¶Âè∑ ÁôªÂΩïË∂äÁã±ÊâãÊú∫‰∏äÁôªÂΩïÁöÑappleË¥¶Âè∑

3. ÁÇπÂáªÊ∑ªÂä†-AppÔºåÈÄâÊã©ÂàöÂÆâË£ÖÂ•ΩÁöÑÂ∫îÁî®-Ê∑ªÂä†

   ![Apple Configurator 2](./image/Apple Configurator 2.png)

   ![add app](./image/add app.png)

4. ÁÇπÂáªÊ∑ªÂä†ÂêéÔºå‰ºöÂ∞ÜËØ•AppÈáçÊñ∞Ê∑ªÂä†Âà∞ÊâãÊú∫‰∏äÔºåÁî±‰∫éÊâãÊú∫‰∏äÂ∑≤ÁªèÂÆâË£Ö‰∫ÜËØ•appÔºåÊ≠§Êó∂‰ºöÊèêÁ§∫ÊòØÂê¶ÊõøÊç¢ËØ•appÔºåÂÖà‰∏çÁÇπÂáª‰ªª‰ΩïÊåâÈíÆÔºåÊâìÂºÄ‰∏Ä‰∏™FinderÔºå(Âø´Êç∑ÈîÆshift+command+G)ÔºåËøõÂÖ•
    '~/Library/Group Containers/K36BKF7T3D.group.com.apple.configurator/Library/Caches/Assets/TemporaryItems/MobileApps/',
    Â∞±ÂèØ‰ª•ÊâæÂà∞ÈúÄË¶ÅÁöÑËµÑÊ∫êÁöÑ.ipaÊñá‰ª∂Ôºå**‚ö†Ô∏èÊ≥®ÊÑèÔºöË¶ÅÊã∑Ë¥ùÂá∫ÂéªÔºåËøá‰∏Ä‰ºöÂèØËÉΩ‰ºöÊ∂àÂ§±Âì¶**

5. Â∞ÜipaÂêéÁºÄ‰øÆÊîπ‰∏∫zipÂêéÁºÄÂêéËß£ÂéãÔºåËøõÂÖ•PayloadÊñá‰ª∂Â§πÔºåÂè≥Âáª.appÊñá‰ª∂ÔºåÊòæÁ§∫ÂåÖÂÜÖÂÆπÂç≥ÂèØÊòæÁ§∫ipaÂåÖÂÜÖÁöÑÊâÄÊúâÊñá‰ª∂

## Á†∏Â£≥

‰ªéAppstrore‰∏ãËΩΩÁöÑÂ∫îÁî®ÊòØÁªèËøáËãπÊûúÂä†ÂØÜÁöÑipaÂåÖÔºåËé∑ÂèñappstoreÁöÑÂåÖ‰πãÂêéÈúÄË¶ÅËß£ÂØÜ‰πãÂêéÊâçÂèØ‰ª•ÂÅöËá™Â∑±ÁöÑ‰øÆÊîπÂπ∂Á≠æÂêçÂÆâË£ÖÂà∞ÊâãÊú∫‰∏ä„ÄÇËß£ÂØÜÁöÑ‰∏ªË¶ÅÊìç‰Ωú‰∏∫Ëß£ÂØÜipaÂåÖ‰∏≠ÁöÑÂèØÊâßË°åÊñá‰ª∂(Mach-O)Ôºå‰øóÁß∞Á†∏Â£≥

### Ëß£ÂØÜÂ∫îÁî®ÂÜÖÁöÑÂèØÊâßË°åÊñá‰ª∂(Mach-O)

1. ÊâìÂºÄÂ∑≤ÁªèË∂äÁã±ÁöÑiPhoneÊâãÊú∫(ÂÖ∑‰ΩìË∂äÁã±ÊñπÊ≥ïËøôÈáåÂ∞±‰∏ç‰ªãÁªç‰∫Ü)ÔºåËøõÂÖ•CydiaÔºåÂÆâË£ÖOpenSSH„ÄÅCycriptËøô‰∏§Ê¨æËΩØ‰ª∂„ÄÇ

   ![Cydia](./image/Cydia.jpeg)

   ![OpenSSH:Cycript](./image/OpenSSH:Cycript.jpeg)

2. ÊâìÂºÄMacÁîµËÑëÁªàÁ´ØÔºåËøûÊé•iPhoneÔºåÁî®sshËøõÂÖ•Ëøû‰∏äÁöÑiPhone(Á°Æ‰øùiPhoneÂíåMacÂú®Âêå‰∏Ä‰∏™ÁΩëÊÆµÔºâ

   ![ssh](./image/ssh.png)

3. Ëé∑ÂèñÁ†∏Â£≥Â∫îÁî®ÁöÑBundle idÔºöËæìÂÖ•ÂëΩ‰ª§ ps -eÔºåËÆ∞ÂΩï‰∏ãÊ≠§Êó∂ÁöÑbundleË∑ØÂæÑ

   ![bundle id](./image/bundle id.png)

4. Áî®CycriptÊâæÂá∫ÂæÆ‰ø°ÁöÑDocumentsÁöÑË∑ØÂæÑÔºåËæìÂÖ•ÂëΩ‰ª§cycript -p WeChatÔºåËÆ∞ÂΩï‰∏ãÊ≠§Êó∂ÁöÑDocumentË∑ØÂæÑ

   ![cycript](./image/cycript.png)

5. ÁºñËØëdumpdecryptedÔºåÁî®dumpdecryptedÊù•‰∏∫ÂæÆ‰ø°‰∫åËøõÂà∂Êñá‰ª∂(WeChat)Á†∏Â£≥ÔºåÁ°Æ‰øùÊàë‰ª¨‰ªéGithub‰∏ä‰∏ãËΩΩ‰∫ÜÊúÄÊñ∞ÁöÑdumpdecryptedÊ∫êÁ†ÅÔºåÊâìÂºÄMacÁîµËÑëÁªàÁ´ØÔºåËøõÂÖ•dumpdecryptedÊ∫êÁ†ÅÁöÑÁõÆÂΩïÔºåÁºñËØëdumpdecrypted.dylibÔºåÂëΩ‰ª§Â¶Ç‰∏ã:

   ![dumpdecrypte](./image/dumpdecrypted.png)

   ËøôÊ†∑Êàë‰ª¨ÂèØ‰ª•ÁúãÂà∞dumpdecryptedÁõÆÂΩï‰∏ãÁîüÊàê‰∫Ü‰∏Ä‰∏™dumpdecrypted.dylibÁöÑÊñá‰ª∂„ÄÇ

6. scpÊã∑Ë¥ùdumpdecrypted.dylibÂà∞iPhone‰∏äÔºåÁõÆÊ†áË∑ØÂæÑ‰∏∫Á¨¨4Ê≠•‰∏≠Ëé∑ÂèñÂà∞ÁöÑDocumentË∑ØÂæÑÔºåËøôÈáåÊàë‰ª¨Áî®Âà∞scpÂëΩ‰ª§„ÄÇ

   scp Ê∫êÊñá‰ª∂Ë∑ØÂæÑ ÁõÆÊ†áÊñá‰ª∂Ë∑ØÂæÑ „ÄÇÂÖ∑‰ΩìÂ¶Ç‰∏ãÔºö

   ![scp dumpdecrypted](./image/scp dumpdecrypted.png)

7. ÂºÄÂßãÁ†∏Â£≥Ôºådumpdecrypted.dylibÁöÑÂÖ∑‰ΩìÁî®Ê≥ïÊòØÔºöDYLD_INSERT_LIBRARIES=/PathFrom/dumpdecrypted.dylib /PathTo

   ![DYLD_INSERT_LIBRARIES](./image/DYLD_INSERT_LIBRARIES.png)

   ËøôÊ†∑Â∞±‰ª£Ë°®Á†∏Â£≥ÊàêÂäü‰∫ÜÔºåÂΩìÂâçÁõÆÂΩï‰∏ã‰ºöÁîüÊàêÁ†∏Â£≥ÂêéÁöÑÊñá‰ª∂ÔºåÂç≥WeChat.decrypted„ÄÇÂú®MacÁªàÁ´Ø‰∏äÔºåÂêåÊ†∑Áî®scpÂëΩ‰ª§ÊääWeChat.decryptedÊñá‰ª∂Êã∑Ë¥ùÂà∞ÁîµËÑë‰∏ä,Êé•‰∏ãÊù•Êàë‰ª¨Ë¶ÅÊ≠£ÂºèÁöÑdumpÂæÆ‰ø°ÁöÑÂèØÊâßË°åÊñá‰ª∂‰∫Ü„ÄÇ

   ![scp wechat](./image/scp wechat.png)

## Ê≥®ÂÖ•

### dumpÂæÆ‰ø°ÂèØÊâßË°åÊñá‰ª∂

‰ªéGithub‰∏ä‰∏ãËΩΩÊúÄÊñ∞ÁöÑclass-dumpÊ∫ê‰ª£Á†ÅÔºåÁÑ∂ÂêéÁî®XcodeÁºñËØëÂç≥ÂèØÁîüÊàêclass-dump(ËøôÈáåÊØîËæÉÁÆÄÂçïÔºåÁ¨îËÄÖÂ∞±‰∏çËØ¶ÁªÜËØ¥Êòé‰∫Ü)„ÄÇ

‰ΩøÁî®class-dumpÂëΩ‰ª§,ÊääÂàöÂàöÁ†∏Â£≥ÂêéÁöÑWeChat.decrypted,ÂØºÂá∫ÂÖ∂‰∏≠ÁöÑÂ§¥Êñá‰ª∂„ÄÇ./class-dump -s -S -H ./WeChat.decrypted -o ./WeChatHeader

![class-dump](./image/class-dump.png)

### Êñ∞Âª∫frameworkÂ∑•Á®ã

![new framework](./image/new framework.png)

### Êê≠Âª∫Ëá™Âä®ÈáçÁ≠æÂêçËÑöÊú¨ËøêË°åÁéØÂ¢É

![new script](./image/new script.png)

![script shell](./image/script shell.png)

Âä†ÂÖ•‰ª•‰∏ãËÑöÊú¨‰ª£Á†Å

```shell

# ${SRCROOT} ‰∏∫Â∑•Á®ãÊñá‰ª∂ÊâÄÂú®ÁöÑÁõÆÂΩï
TEMP_PATH="${SRCROOT}/Temp"
#ËµÑÊ∫êÊñá‰ª∂Â§π,Êîæ‰∏âÊñπAPPÁöÑ
ASSETS_PATH="${SRCROOT}/APP"
#ipaÂåÖË∑ØÂæÑ
TARGET_IPA_PATH="${ASSETS_PATH}/*.ipa"



#Êñ∞Âª∫TempÊñá‰ª∂Â§π
rm -rf "$TEMP_PATH"
mkdir -p "$TEMP_PATH"

# --------------------------------------
# 1. Ëß£ÂéãIPA Âà∞Temp‰∏ã
unzip -oqq "$TARGET_IPA_PATH" -d "$TEMP_PATH"
# ÊãøÂà∞Ëß£ÂéãÁöÑ‰∏¥Êó∂APPÁöÑË∑ØÂæÑ
TEMP_APP_PATH=$(set -- "$TEMP_PATH/Payload/"*.app;echo "$1")
# ËøôÈáåÊòæÁ§∫ÊâìÂç∞‰∏Ä‰∏ã TEMP_APP_PATHÂèòÈáè
echo "TEMP_APP_PATH: $TEMP_APP_PATH"

# -------------------------------------
# 2. ÊääËß£ÂéãÂá∫Êù•ÁöÑ.appÊã∑Ë¥ùËøõÂéª
#BUILT_PRODUCTS_DIR Â∑•Á®ãÁîüÊàêÁöÑAPPÂåÖË∑ØÂæÑ
#TARGET_NAME targetÂêçÁß∞
TARGET_APP_PATH="$BUILT_PRODUCTS_DIR/$TARGET_NAME.app"
echo "TARGET_APP_PATH: $TARGET_APP_PATH"

rm -rf "$TARGET_APP_PATH"
mkdir -p "$TARGET_APP_PATH"
cp -rf "$TEMP_APP_PATH/" "$TARGET_APP_PATH/"

# -------------------------------------
# 3. ‰∏∫‰∫ÜÊòØÈáçÁ≠æËøáÁ®ãÁÆÄÂåñÔºåÁßªËµ∞extensionÂíåwatchAPP. Ê≠§Â§ñ‰∏™‰∫∫ÂÖçË¥πÁöÑËØÅ‰π¶Ê≤°ÂäûÊ≥ïÁ≠æextension

echo "Removing AppExtensions"
rm -rf "$TARGET_APP_PATH/PlugIns"
rm -rf "$TARGET_APP_PATH/Watch"

# -------------------------------------
# 4. Êõ¥Êñ∞ Info.plist ÈáåÁöÑBundleId
#  ËÆæÁΩÆ "Set :KEY Value" "ÁõÆÊ†áÊñá‰ª∂Ë∑ØÂæÑ.plist"
/usr/libexec/PlistBuddy -c "Set :CFBundleIdentifier $PRODUCT_BUNDLE_IDENTIFIER" "$TARGET_APP_PATH/Info.plist"

# 5.ÁªôÂèØÊâßË°åÊñá‰ª∂‰∏äÊùÉÈôê
#Ê∑ªÂä†ipa‰∫åËøõÂà∂ÁöÑÊâßË°åÊùÉÈôê,Âê¶Âàôxcode‰ºöÂëäÁü•Êó†Ê≥ïËøêË°å
#Ëøô‰∏™Êìç‰ΩúÊòØË¶ÅÊâæÂà∞Á¨¨‰∏âÊñπappÂåÖÈáåÁöÑÂèØÊâßË°åÊñá‰ª∂ÂêçÁß∞ÔºåÂõ†‰∏∫info.plistÁöÑ 'Executable file' keyÂØπÂ∫îÁöÑÊòØÂèØÊâßË°åÊñá‰ª∂ÁöÑÂêçÁß∞
#Êàë‰ª¨grep ‰∏Ä‰∏ã,ÁÑ∂ÂêéÂèñÊúÄÂêé‰∏ÄË°å, ÁÑ∂Âêé‰ª•cut ÂëΩ‰ª§ÂàÜÂâ≤ÔºåÂèñÂá∫ÊÉ≥Ë¶ÅÁöÑÂÖ≥ÈîÆ‰ø°ÊÅØ„ÄÇÂ≠òÂà∞APP_BINARYÂèòÈáèÈáå
APP_BINARY=`plutil -convert xml1 -o - $TARGET_APP_PATH/Info.plist|grep -A1 Exec|tail -n1|cut -f2 -d\>|cut -f1 -d\<`


#Ëøô‰∏™‰∏∫‰∫åËøõÂà∂Êñá‰ª∂Âä†‰∏äÂèØÊâßË°åÊùÉÈôê +X
chmod +x "$TARGET_APP_PATH/$APP_BINARY"



# -------------------------------------
# 6. ÈáçÁ≠æÁ¨¨‰∏âÊñπapp Frameworks‰∏ãÂ∑≤Â≠òÂú®ÁöÑÂä®ÊÄÅÂ∫ì
TARGET_APP_FRAMEWORKS_PATH="$TARGET_APP_PATH/Frameworks"
if [ -d "$TARGET_APP_FRAMEWORKS_PATH" ];
then
#ÈÅçÂéÜÂá∫ÊâÄÊúâÂä®ÊÄÅÂ∫ìÁöÑË∑ØÂæÑ
for FRAMEWORK in "$TARGET_APP_FRAMEWORKS_PATH/"*
do
echo "üç∫üç∫üç∫üç∫üç∫üç∫FRAMEWORK : $FRAMEWORK"
#Á≠æÂêç
/usr/bin/codesign --force --sign "$EXPANDED_CODE_SIGN_IDENTITY" "$FRAMEWORK"
done
fi
```

new groupÂëΩÂêç‰∏∫APPÂπ∂Â∞ÜÂ∑≤Á†∏Â£≥ÁöÑipaÊñá‰ª∂ÊîæÂÖ•Êñá‰ª∂Â§π

![new group APP](./image/new group APP.png)

###ÁºñÂÜôhook‰ª£Á†Å

Ê†πÊçÆÂ§¥Êñá‰ª∂ÂèäÈúÄË¶Å‰øÆÊîπÁöÑÂäüËÉΩÁºñÂÜôhook‰ª£Á†ÅÔºåÁ§∫‰æãÂ¶Ç‰∏ãÔºö

1. ‰øÆÊîπÊüêViewController‰∏≠ÁöÑÊüêÊñπÊ≥ï

   ```objective-c
   #import "MoreTableHook.h"
   #import <objc/runtime.h>
   
   @implementation MoreTableHook
   
   + (void)load
   {
       NSLog(@"hook load");
       Class origin_class  = NSClassFromString(@"MoreTableViewController");
       Class swizzed_class = [self class];
       
       SEL origin_selector = NSSelectorFromString(@"numberOfSectionsInTableView:");
       SEL swizzed_selector = NSSelectorFromString(@"new_numberOfSectionsInTableView:");
       
       Method origin_method = class_getInstanceMethod(origin_class, origin_selector);
       Method swizzed_method = class_getInstanceMethod(swizzed_class, swizzed_selector);
       
       BOOL add_method = class_addMethod(origin_class,
                                         swizzed_selector,
                                         method_getImplementation(swizzed_method),
                                         method_getTypeEncoding(swizzed_method));
       if (!add_method) {
           return;
       }
       
       swizzed_method = class_getInstanceMethod(origin_class, swizzed_selector);
       if (!swizzed_method) {
           return;
       }
       
       BOOL did_add_method = class_addMethod(origin_class,
                                             origin_selector,
                                             method_getImplementation(swizzed_method),
                                             method_getTypeEncoding(swizzed_method));
       if (did_add_method) {
           class_replaceMethod(origin_class,
                               swizzed_selector,
                               method_getImplementation(origin_method),
                               method_getTypeEncoding(origin_method));
       }else{
           method_exchangeImplementations(origin_method, swizzed_method);
       }
   }
   
   - (long long)numberOfSectionsInTableView:(id)arg1;
   {
       [self numberOfSectionsInTableView:arg1];
       return 1;
   }
   
   @end
   ```

   

2. ‰øÆÊîπÊüêÁ≥ªÁªüÁ±ªÁöÑÊüêÊñπÊ≥ï‚Äî‚ÄîÂàõÂª∫categoryÁ±ªhookÂéüMethod

   ```objective-c
   #import "UILabel+HookSetText.h"
   #import <objc/runtime.h>
   
   @implementation UILabel (HookSetText)
   
   + (void)load
   {
       Class clazz = [self class];
       
       SEL setTextSelector = @selector(setText:);
       SEL new_setTextSelector = @selector(new_setText:);
       
       Method setTextMethod = class_getInstanceMethod(clazz, setTextSelector);
       Method new_setTextMethod = class_getInstanceMethod(clazz, new_setTextSelector);
       
       BOOL did_add_method = class_addMethod(clazz,
                                             setTextSelector,
                                             method_getImplementation(new_setTextMethod),
                                             method_getTypeEncoding(new_setTextMethod));
       if (did_add_method) {
           class_replaceMethod(clazz,
                               new_setTextSelector,
                               method_getImplementation(setTextMethod),
                               method_getTypeEncoding(setTextMethod));
       }else{
           method_exchangeImplementations(setTextMethod, new_setTextMethod);
       }
       
   }
   
   - (void)new_setText:(NSString *)text
   {
       if ([text isEqualToString:@"ÂæÆ‰ø°"]) {
           [self new_setText:@"new_ÂæÆ‰ø°"];
       }else {
           [self new_setText:text];
       }
       
   }
   
   @end
   ```

### Âä®ÊÄÅÊ≥®ÂÖ•ipa

